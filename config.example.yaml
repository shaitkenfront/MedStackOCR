pipeline:
  review_threshold: 0.72
  reject_threshold: 0.35
  candidate_threshold: 2.5
  target_tax_year: 2026
  year_consistency:
    enabled: true
    min_samples: 5
    dominant_ratio_threshold: 0.65
    weight_by_confidence: true

ocr:
  engine: documentai
  allowed_engines:
    - documentai
  engines:
    mock:
      enabled: false
    documentai:
      enabled: true
      project_id:
      location: us
      processor_id:
      processor_version:
      endpoint:
      credentials_path:
      timeout_sec: 120
      mime_type:
      field_mask:
      amount_tuning:
        exclude_context_currency_primary_penalty: 1.0
        currency_primary_bonus: 1.2
        near_secondary_without_currency_penalty: 1.8
        address_context_penalty: 2.2
        medication_context_penalty: 1.8
        long_text_number_penalty: 2.2
        long_text_min_length: 28
        long_text_min_digits: 3
        small_plain_number_penalty: 2.4
        label_alignment_bonus_max: 3.0
        label_alignment_max_dx: 0.25
        label_alignment_max_dy: 0.08
        label_anchor_max_length: 16
        label_anchor_max_digits: 2

templates:
  store_path: data/templates
  household_match_threshold: 0.65

family_registry:
  required: true
  members:
    - canonical_name: "山田 太郎"
      aliases:
        - "山田太郎"
        - "山田 太郎様"
        - "ヤマダ タロウ"
        - "ヤマタ タロウ"
    - canonical_name: "山田 花子"
      aliases:
        - "山田花子"
        - "山田 花子様"
        - "ヤマダ ハナコ"
        - "ヤマタ ハナコ"

notifications:
  enabled: false
  channels:
    - slack
    # - line
    # - discord
  max_items_in_message: 10
  slack:
    webhook_url:
  discord:
    webhook_url:
  line:
    channel_access_token:
    to:

line_messaging:
  enabled: false
  channel_secret:
  channel_access_token:
  webhook_path: /webhook/line
  api_base_url: https://api.line.me
  data_api_base_url: https://api-data.line.me
  timeout_sec: 10
  allowed_user_ids: []
  default_household_id:

inbox:
  backend: sqlite  # sqlite or dynamodb
  sqlite_path: data/inbox/linebot.db
  dynamodb:
    region:
    table_prefix: medstackocr
    event_ttl_days: 7
    tables:
      event_dedupe:
      receipts:
      receipt_fields:
      sessions:
      aggregate_entries:
      family_registry:
  image_store_dir: data/inbox/images
  image_retention_days: 14
  session_ttl_minutes: 60
  max_candidate_options: 3
  enable_text_commands: true

output:
  save_audit: true
  pretty_json: true
